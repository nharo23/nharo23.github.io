<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>[JAVA] Hibernate Second Level Cache | 잡동사니 모음</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[JAVA] Hibernate Second Level Cache</h1><a id="logo" href="/.">잡동사니 모음</a><p class="description">잊어버리기 쉬운 1원짜리 팁들의 모음</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">[JAVA] Hibernate Second Level Cache</h1><div class="post-meta">Aug 18, 2018</div><div class="post-content"><ul>
<li><a href="http://www.baeldung.com/hibernate-second-level-cache" target="_blank" rel="noopener">http://www.baeldung.com/hibernate-second-level-cache</a></li>
<li>second-level cache is SessionFactory-scoped, meaning it is shared by all sessions created with the same session factory</li>
<li>Also, the loaded instance state is stored in L2 cache if it was not there already.</li>
<li>Enabling Second-level Caching<pre><code>hibernate.cache.use_second_level_cache=true
hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory
</code></pre></li>
<li><p>Making an Entity Cachable</p>
<pre><code>@Entity
@Cacheable
@org.hibernate.annotations.Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
public class Foo {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Column(name = &quot;ID&quot;)
    private long id;

    @Column(name = &quot;NAME&quot;)
    private String name;

    // getters and setters
}
</code></pre></li>
<li><p>Cache Concurrency Strategy</p>
<pre><code>Based on use cases, we are free to pick one of the following cache concurrency strategies:

READ_ONLY: Used only for entities that never change (exception is thrown if an attempt to update such an entity is made). It is very simple and performant. Very suitable for some static reference data that don’t change

NONSTRICT_READ_WRITE: Cache is updated after a transaction that changed the affected data has been committed. Thus, strong consistency is not guaranteed and there is a small time window in which stale data may be obtained from cache. This kind of strategy is suitable for use cases that can tolerate eventual consistency

READ_WRITE: This strategy guarantees strong consistency which it achieves by using ‘soft’ locks: When a cached entity is updated, a soft lock is stored in the cache for that entity as well, which is released after the transaction is committed. All concurrent transactions that access soft-locked entries will fetch the corresponding data directly from database

TRANSACTIONAL: Cache changes are done in distributed XA transactions. A change in a cached entity is either committed or rolled back in both database and cache in the same XA transaction
</code></pre></li>
<li>XA Transaction<ul>
<li><a href="https://docs.microsoft.com/ko-kr/sql/connect/jdbc/understanding-xa-transactions" target="_blank" rel="noopener">https://docs.microsoft.com/ko-kr/sql/connect/jdbc/understanding-xa-transactions</a><pre><code>XA transactions are designed to allow distributed transactions, where a transaction manager (the application) controls a transaction which involves multiple resources. Such resources are usually DBMSs, but could be resources of any type. The whole set of required transactional operations is called a global transaction. Each subset of operations which involve a single resource is called a local transaction. XA used a 2-phases commit (2PC). With the first commit, the transaction manager tells each resource to prepare an effective commit, and waits for a confirm message. The changes are not still made effective at this point. If any of the resources encountered an error, the transaction manager will rollback the global transaction. If all resources communicate that the first commit is successful, the transaction manager can require a second commit, which makes the changes effective.
</code></pre></li>
</ul>
</li>
<li>Tutorial<ul>
<li><a href="https://github.com/eugenp/tutorials/tree/master/persistence-modules/spring-jpa" target="_blank" rel="noopener">https://github.com/eugenp/tutorials/tree/master/persistence-modules/spring-jpa</a></li>
</ul>
</li>
</ul>
</div><div class="tags"><a href="/tags/java-development/">java, development</a></div><div class="post-nav"><a class="pre" href="/2018/08/18/AWS-ElasticSearch-Service-수동-스냅샷-및-복원/">[AWS] ElasticSearch Service 수동 스냅샷 및 복원</a><a class="next" href="/2018/08/18/Github-하나의-컴퓨터에서-복수-계정에-대한-RSA-만들기/">[Github] 하나의 컴퓨터에서 복수 계정에 대한 RSA 만들기</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://nharo23.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/aws-es/" style="font-size: 15px;">aws, es</a> <a href="/tags/git-github/" style="font-size: 15px;">git, github</a> <a href="/tags/java-development/" style="font-size: 15px;">java, development</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/AWS-ElasticSearch-Service-수동-스냅샷-및-복원/">[AWS] ElasticSearch Service 수동 스냅샷 및 복원</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/JAVA-Hibernate-Second-Level-Cache/">[JAVA] Hibernate Second Level Cache</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/Github-하나의-컴퓨터에서-복수-계정에-대한-RSA-만들기/">[Github] 하나의 컴퓨터에서 복수 계정에 대한 RSA 만들기</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">잡동사니 모음.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>